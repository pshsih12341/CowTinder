# `AgroCode Hack Genetics`

***`MISIS x BGITU`***

Team Members:

1. **Дмитрий Коноплянников** - Backend, DevOps
2. **Виктория Гайлитис** - Backend
3. **Дарья Короленко** - Design
4. **Ильдар Ишбулатов** - Frontend

Презентация: [тык](https://drive.google.com/drive/u/0/folders/1CPgSK59kDkxS68eUezhUgMiR6wq9Hvrl)

API - [тык](https://agro.itatmisis.ru/api/docs)

## Кейс "Тиндер" для коров

> ### `Разработать мобильное или веб-приложение для поиска подходящего партнера для скрещивания крупного рогатого скота на основе данных из электронных паспортов животных с целью долгосрочного повышения производительности стада.`

## Предложенное решение

Алгоритм, который мы предлагаем, состоит из нескольких этапов: сначала мы оцениваем совместимость коров по фенотипу, затем анализируем их генотипы и вычисляем вероятность передачи мутаций и эффект от этих мутаций на определённые признаки.

### 1. Оценка совместимости по фенотипу

На первом этапе оцениваем совместимость коров по их фенотипам. Алгоритм включает следующие этапы:

* **Сравнение фенотипов каждой пары коров** : Для каждой пары коров анализируем их фенотипы по различным признакам (например, удой, упитанность, коэффициент инбридинга и т. д.).
* **Оценка "хорошести" для каждого направления** : Для каждого признака вычисляем, насколько фенотип каждой коровы близок к оптимальному значению. Это значение может быть задано как некоторый эталон (например, на основе статистических данных или опыта).
* **Применение штрафов за отклонения** : Если фенотип коровы отклоняется от оптимального значения, вычисляется штраф и этот штраф добавляется к общей оценке.
* **Расчёт совместимости** : Для каждой пары коров рассчитывается их совместимость в процентах на основе суммы этих оценок. Например, если обе коровы имеют близкие к оптимальному значениям, то их совместимость будет высокой.

### 2. Оценка совместимости по генотипу

После того как составили список лучших коров по фенотипу, мы переходим к анализу их генотипов, чтобы вычислить вероятность появления мутаций и их влияние на потомство. Этот этап можно разделить на несколько шагов:

#### a. Оценка мутаций в генотипах

Каждая корова имеет свой генотип, который включает несколько генов, каждый из которых может иметь различные мутации. На этом этапе анализируются пары генотипов, чтобы определить вероятность появления мутаций у потомства:

* **Проверка совместных мутаций** : Для каждой пары коров смотрим на каждый ген, чтобы увидеть, имеют ли обе коровы одинаковую мутацию в этом гене. Если обе коровы имеют одинаковую мутацию (например, мутация в одном и том же месте), вероятность появления этой мутации у потомства будет 100%. Если хотя бы одна из коров имеет эту мутацию, вероятность будет 50%.
* **Мутации с разной вероятностью** : Если оба родителя имеют разные мутации в одном месте, то вероятность их проявления в потомстве будет варьироваться, например, в зависимости от закона Менделя.

#### b. Расчёт бета-коэффициента

Затем рассчитывается эффект от этих мутаций на целевые признаки (например, удой, упитанность):

Каждая корова имеет определённые гены, и в этих генах могут быть мутации, которые могут повлиять на её характеристики (например, удой, упитанность и т. д.). Эти мутации могут быть:

* **Гомозиготными** (когда у коровы два одинаковых гена на определённом участке — например, "A/A").
* **Гетерозиготными** (когда у коровы два разных гена — например, "A/B").

Если мутация  **гомозиготная** , то её влияние на признак будет сильнее, и коэффициент влияния умножается на 2. Если мутация  **гетерозиготная** , то влияние считается по обычному коэффициенту.

После того как посчитали, как мутация влияет на признаки, нужно учесть, как это будет отображаться в потомстве коров.

* **Удой**: Если две коровы, которые будут пароваться, — самки, то молочность у потомства рассчитывается как среднее значение молочности этих коров, и к этому значению добавляется эффект мутации (например, улучшение или ухудшение молочности). Если одна из коров самка, то молочность берётся от этой коровы, и к ней тоже добавляется эффект мутации.
* Для других признаков, таких как **упитанность** или  **здоровье** , молекулы этих признаков усредняются между двумя коровами, и затем к этому значению добавляется эффект мутации.

### 3. Корректировка значений

После того как все эффекты учтены и новые значения признаков рассчитаны, они могут быть ограничены:

* Например, упитанность может быть только в пределах от 1 до 5.
* Здоровье должно быть в пределах от 1 до 10.
* Генетическая ценность может не превышать 100 баллов.
* Также если результат по какому-то признаку стал отрицательным, его обязательно корректируют, чтобы не было значений меньше нуля.

### 3. Итоговый расчёт совместимости и мутаций

После того как мы рассчитаете вероятности для всех мутаций и их эффекты на признаки, можно получить итоговое значение совместимости для каждой пары коров с учётом как фенотипической, так и генотипической оценки:

* **Совместимость по фенотипу** : Исходная совместимость, рассчитанная на основе фенотипов, может быть скорректирована с учётом генетической совместимости и вероятностей мутаций.
* **Оценка мутаций** : Влияние мутаций на признаки потомства может быть добавлено к общей оценке совместимости. Например, если пара коров имеет высокую фенотипическую совместимость, но их генотипы не очень совместимы по мутациям, то это может снизить общую оценку совместимости.

Таким образом, мы получаем не просто список лучших коров, но и оценку того, как их генотипы будут влиять на потомство в генетическом плане.

## Сборка

##### Локалькая сборка:

1. Установить postgresql, docker
2. Открыть docker desktop
3. Заполнить все необходимые поля в .env, их нужно создавать по шаблону .env.sample и в том же месте, где находится этот файл
4. В терминале написать docker-compose up --build -d

##### Сборка на сервере:

1. На сервер установить и настроить nodeJS, npx, nginx, docker, git
2. С помощью git клонируем нашу репозиторию
3. Заполнить все необходимые поля в .env, их нужно создавать по шаблону .env.sample и в том же месте, где находится этот файл
4. И запускаем наш docker compose up --build -d
